//
   Created by msgis-student on 6/9/2017.

doctype html
html
  head
    title= title
    link(rel='stylesheet', href='https://unpkg.com/leaflet@1.0.3/dist/leaflet.css')
    link(rel='stylesheet', href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.css")
    link(rel='stylesheet', href='/public/css/styledLayerControl.css')
    script(src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous")
    script(src="https://unpkg.com/kinto@9.0.2/dist/kinto.min.js")
    script(src="https://unpkg.com/dexie@latest/dist/dexie.js")
    script(src='https://unpkg.com/leaflet@1.0.3/dist/leaflet.js' type='text/javascript')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.9/leaflet.draw.js' type='text/javascript')
    script(src='https://cdn.jsdelivr.net/jquery.loadingoverlay/1.5.3/loadingoverlay.js' type='text/javascript')
    script(src='https://cdn.jsdelivr.net/jquery.loadingoverlay/latest/loadingoverlay_progress.min.js' type='text/javascript')
    //script(src="https://jsconsole.com/js/remote.js?f7599f18-06f3-47dc-bb3f-f41097176b9b")
    
    //script(src='https://unpkg.com/leaflet-sidebar')
    script(src='https://unpkg.com/leaflet-sidebar-v2')
    
    script(src='/public/scripts/featureStyles.js')
    script(src='/public/scripts/styledLayerControl.js')
    //link(href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css", rel="stylesheet")
    
    // Latest compiled and minified CSS
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css', integrity='sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u', crossorigin='anonymous')
    // Optional theme
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css', integrity='sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp', crossorigin='anonymous')
    // Latest compiled and minified JavaScript
    script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js', integrity='sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa', crossorigin='anonymous')

    style(type='text/css').
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      
      #header {
        height: 7%;
      }

      #map {
        float: left;
        width: 100%;
        height: 93%;
      }

      #popUp_FormDIV {
        float: right;
        width: 20%;
        height: 90%;
        overflow: auto;
      }

      #popUpDIV {
        display: block;
        /* float: left; */
        width: 100%;
        height: 50%;
        overflow: auto;
        margin: 5%;
      }

      #formPopDIV {
        /* float: right; */
        width: 100%;
        bottom: 40%;
        height: 50%;
        /* position: absolute; */
        overflow: auto;
        margin: 5%;
      }
      
      #sidebar1 {
        color: black;
        font-size: 14px;
        
      }
      

      .sidebar {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
        overflow: hidden;
        z-index: 2000; }
        .sidebar.collapsed {
          width: 40px; }
        @media (min-width: 768px) {
          .sidebar {
            top: 50px;
            bottom: 10px;
            transition: width 500ms; } }
        @media (min-width: 768px) and (max-width: 991px) {
          .sidebar {
            width: 305px; } }
        @media (min-width: 992px) and (max-width: 1199px) {
          .sidebar {
            width: 390px; } }
        @media (min-width: 1200px) {
          .sidebar {
            width: 460px; } }
      
      .sidebar-left {
        left: 0; }
        @media (min-width: 768px) {
          .sidebar-left {
            left: 10px; } }
      
      .sidebar-right {
        right: 0; }
        @media (min-width: 768px) {
          .sidebar-right {
            right: 10px; } }
      
      .sidebar-tabs {
        top: 0;
        bottom: 0;
        height: 100%;
        background-color: #fff; }
        .sidebar-left .sidebar-tabs {
          left: 0; }
        .sidebar-right .sidebar-tabs {
          right: 0; }
        .sidebar-tabs, .sidebar-tabs > ul {
          position: absolute;
          width: 40px;
          margin: 0;
          padding: 0; }
          .sidebar-tabs > li, .sidebar-tabs > ul > li {
            width: 100%;
            height: 90px;
            color: #333;
            font-size: 12pt;
            overflow: hidden;
            transition: all 80ms; }
            .sidebar-tabs > li:hover, .sidebar-tabs > ul > li:hover {
              color: #000;
              background-color: #eee; }
            .sidebar-tabs > li.active, .sidebar-tabs > ul > li.active {
              color: #fff;
              background-color: #0074d9; }
            .sidebar-tabs > li.disabled, .sidebar-tabs > ul > li.disabled {
              color: rgba(51, 51, 51, 0.4); }
              .sidebar-tabs > li.disabled:hover, .sidebar-tabs > ul > li.disabled:hover {
                background: transparent; }
              .sidebar-tabs > li.disabled > a, .sidebar-tabs > ul > li.disabled > a {
                cursor: default; }
            .sidebar-tabs > li > a, .sidebar-tabs > ul > li > a {
              display: block;
              width: 100%;
              height: 100%;
              line-height: 40px;
              color: inherit;
              text-decoration: none;
              text-align: center; }
        .sidebar-tabs > ul + ul {
          bottom: 0; }
      
      .sidebar-content {
        position: absolute;
        top: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.70);
        overflow-x: hidden;
        overflow-y: auto; }
        .sidebar-left .sidebar-content {
          left: 40px;
          right: 0; }
        .sidebar-right .sidebar-content {
          left: 0;
          right: 40px; }
        .sidebar.collapsed > .sidebar-content {
          overflow-y: hidden; }
      
      .sidebar-pane {
        display: none;
        left: 0;
        right: 0;
        box-sizing: border-box;
        padding: 10px 20px; }
        .sidebar-pane.active {
          display: block; }
        @media (min-width: 768px) and (max-width: 991px) {
          .sidebar-pane {
            min-width: 265px; } }
        @media (min-width: 992px) and (max-width: 1199px) {
          .sidebar-pane {
            min-width: 350px; } }
        @media (min-width: 1200px) {
          .sidebar-pane {
            min-width: 420px; } }
      
      .sidebar-header {
        margin: -10px -20px 0;
        height: 40px;
        padding: 0 20px;
        line-height: 40px;
        font-size: 14.4pt;
        color: #fff;
        background-color: #0074d9; }
        .sidebar-right .sidebar-header {
          padding-left: 40px; }
      
      .sidebar-close {
        position: absolute;
        top: 0;
        width: 40px;
        height: 40px;
        text-align: center;
        cursor: pointer; }
        .sidebar-left .sidebar-close {
          right: 0; }
        .sidebar-right .sidebar-close {
          left: 0; }
      
      .sidebar-left ~ .sidebar-map {
        margin-left: 40px; }
        @media (min-width: 768px) {
          .sidebar-left ~ .sidebar-map {
            margin-left: 0; } }
      
      .sidebar-right ~ .sidebar-map {
        margin-right: 40px; }
        @media (min-width: 768px) {
          .sidebar-right ~ .sidebar-map {
            margin-right: 0; } }
      
      .sidebar {
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65); }
        .sidebar.leaflet-touch {
          box-shadow: none;
          border-right: 2px solid rgba(0, 0, 0, 0.2); }
        @media (min-width: 768px) {
          .sidebar {
            border-radius: 4px; }
            .sidebar.leaflet-touch {
              border: 2px solid rgba(0, 0, 0, 0.2); } }
      
      @media (min-width: 768px) {
        .sidebar-left ~ .sidebar-map .leaflet-left {
          transition: left 500ms; } }
      
      @media (min-width: 768px) and (max-width: 991px) {
        .sidebar-left ~ .sidebar-map .leaflet-left {
          left: 315px; } }
      
      @media (min-width: 992px) and (max-width: 1199px) {
        .sidebar-left ~ .sidebar-map .leaflet-left {
          left: 400px; } }
      
      @media (min-width: 1200px) {
        .sidebar-left ~ .sidebar-map .leaflet-left {
          left: 470px; } }
      
      @media (min-width: 768px) {
        .sidebar-left.collapsed ~ .sidebar-map .leaflet-left {
          left: 50px; } }
      
      @media (min-width: 768px) {
        .sidebar-right ~ .sidebar-map .leaflet-right {
          transition: right 500ms; } }
      
      @media (min-width: 768px) and (max-width: 991px) {
        .sidebar-right ~ .sidebar-map .leaflet-right {
          right: 315px; } }
      
      @media (min-width: 992px) and (max-width: 1199px) {
        .sidebar-right ~ .sidebar-map .leaflet-right {
          right: 400px; } }
      
      @media (min-width: 1200px) {
        .sidebar-right ~ .sidebar-map .leaflet-right {
          right: 470px; } }
      
      @media (min-width: 768px) {
        .sidebar-right.collapsed ~ .sidebar-map .leaflet-right {
          right: 50px; } }

    body
      #header
        nav.navbar.navbar-default.navbar-inverse(role='navigation')
          .container-fluid
            // Brand and toggle get grouped for better mobile display
            .navbar-header
              button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#bs-example-navbar-collapse-1')
                span.sr-only Toggle navigation
                span.icon-bar
                span.icon-bar
                span.icon-bar
              a.navbar-brand Snap Restoration
            // Collect the nav links, forms, and other content for toggling
            #bs-example-navbar-collapse-1.collapse.navbar-collapse
              ul.nav.navbar-nav
                li.active
                  a(href='#') Home
              ul.nav.navbar-nav.navbar-right
                li
                  p.navbar-text Already have an account?
                li.dropdown
                  a.dropdown-toggle(href='#', data-toggle='dropdown')
                    b Login
                    span.caret
                  ul#login-dp.dropdown-menu
                    li
                      .row
                        .col-md-12
                          form#login-nav.form(role='form', method='post', action='login', accept-charset='UTF-8')
                            .form-group
                              label.sr-only(for='exampleInputEmail2') Email address
                              input#exampleInputEmail2.form-control(type='email', placeholder='Email address', required='')
                            .form-group
                              label.sr-only(for='exampleInputPassword2') Password
                              input#exampleInputPassword2.form-control(type='password', placeholder='Password', required='')
                              .help-block.text-right
                                a(href='') Forget the password ?
                            .form-group
                              button.btn.btn-primary.btn-block(type='submit') Sign in
                            .checkbox
                              label
                                input(type='checkbox')
                                |  keep me logged-in
                                
      //#sidebar.sidebar.collapsed
        // Nav tabs
        .sidebar-tabs
          ul(role='tablist')
            li
              a(href='#home', role='tab')
                i.fa.fa-bars
            li
              a(href='#profile', role='tab')
                i.fa.fa-user
            li.disabled
              a(href='#messages', role='tab')
                i.fa.fa-envelope
            li
              a(href='https://github.com/Turbo87/sidebar-v2', role='tab', target='_blank')
                i.fa.fa-github
          ul(role='tablist')
            li
              a(href='#settings', role='tab')
                i.fa.fa-gear
        // Tab panes
        .sidebar-content
          #home.sidebar-pane
            h1.sidebar-header
              | sidebar-v2
              span.sidebar-close
                i.fa.fa-caret-left
          #profile.sidebar-pane
            h1.sidebar-header
              | Profile
              span.sidebar-close
                i.fa.fa-caret-left
          #messages.sidebar-pane
            h1.sidebar-header
              | Messages
              span.sidebar-close
                i.fa.fa-caret-left
          #settings.sidebar-pane
            h1.sidebar-header
              | Settings
              span.sidebar-close
                i.fa.fa-caret-left
                
                
      #overlay
      #map

        script(src='/public/scripts/asyncAddLayers.js')
        //script(src='/public/scripts/sidebar.js')
        script.
          var map = L.map('map').setView([36.211303, -115.114929], 8);

          // https://stackoverflow.com/questions/39767499/how-to-set-the-zindex-layer-order-for-geojson-layers
          // createPane was used in this thread to control the order of the layers
          
          map.createPane('Points').style.zIndex = 390;
          map.createPane('Lines').style.zIndex = 380;
          map.createPane('Polygons').style.zIndex = 370;
          map.createPane('Regions').style.zIndex = 360;
          map.createPane('Bounds_County').style.zIndex = 350;
          map.createPane('Misc').style.zIndex = 340;

          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: '<a href="http://mojavedata.gov/sitemap.html">Site Map</a>&nbsp;&nbsp;&nbsp;' +
            '<a href="http://mojavedata.gov/security.html">Privacy &amp; Security</a>&nbsp;&nbsp;&nbsp;' +
            '<a href="http://mojavedata.gov/foia.html">FOIA</a>&nbsp;&nbsp;&nbsp;' +
            '<a href="http://mojavedata.gov/nofear.html">No Fear Act</a>&nbsp;&nbsp;&nbsp;' +
            '<a href="http://mojavedata.gov/license.html">License</a>&nbsp;&nbsp;&nbsp;' +
            '<a href="http://dodcio.defense.gov/DoDSection508/Std_Stmt.aspx" target="_blank">Accessibility/Section 508</a>&nbsp;&nbsp;&nbsp;' +
            '<a href="http://www.usa.gov" target="_blank">USA.gov</a>',
            maxZoom: 18,
            id: 'rogerdodger617.2p4pk9co',
            accessToken: 'pk.eyJ1Ijoicm9nZXJkb2RnZXI2MTciLCJhIjoiY2l5aG83M3pzMDR3aDJ3cndobzdzOWFhMSJ9.b6ssRylqfIz40O7vKcDb2g'
          }).addTo(map);

          (async function () {
            try {
              await getLayers();
            }
            catch (err) {
              console.error(err)
            }
          }());
        
          var controlOptions = {
            container_width: "300px",
            container_maxHeight: "350px",
            group_maxHeight: "80px",
            autoZIndex: false,
            exclusive: false
          };

          var overLay = []

          var control = L.Control.styledLayerControl(null, overLay, controlOptions);
          map.addControl(control);
            
          // creates a temp layer so it can store the new features
          var editableLayers = new L.FeatureGroup();
          map.addLayer(editableLayers);

          var options = {
            position: 'bottomright',
            draw: {
              polyline: {
                allowIntersection: false,
                drawError: {
                  color: '#e10100', // Color the shape will turn when intersects
                  message: '<strong>Oh snap!<strong> you can\'t draw that!' // Message that will show when intersect
                },
                shapeOptions: {
                  color: '#e10100',
                  weight: 3
                }
              },
              polygon: {
                allowIntersection: false, // Restricts shapes to simple polygons
                drawError: {
                  color: '#e10100', // Color the shape will turn when intersects
                  message: '<strong>Oh snap!<strong> you can\'t draw that!' // Message that will show when intersect
                },
                shapeOptions: {
                  color: '#e10100'
                }
              },
              circle: false, // Turns off this drawing tool
              rectangle: false,
              marker: {
                icon: new L.Icon.Default()
              }
            },
            edit: {
              featureGroup: editableLayers, //REQUIRED!!
              edit: true,
              remove: true
            }
          };

          var drawControl = new L.Control.Draw(options);
          map.addControl(drawControl);

          var thisLayer
          

          map.on(L.Draw.Event.CREATED, function (event) {
            var layer = event.layer;
            editableLayers.addLayer(layer);
            thisLayer = layer.toGeoJSON();
            console.log(thisLayer);
          });
      
      //#sidebar
        h1 leaflet-sidebar
        #sidebar1
        #sidebar2
          script(src='/public/scripts/formDIV.js')

      //script.
        var sidebar = L.control.sidebar('sidebar', {
              closeButton: true,
              position: 'left'
        });
        map.addControl(sidebar);
        
        setTimeout(function () {
            sidebar.show();
        }, 20000);
        sidebar.getContainer('#popUpDIV');
        
      #sidebar.sidebar.collapsed
        // Nav tabs
        .sidebar-tabs
          ul(role='tablist')
            // top aligned tabs
            li
              a(href='#layers', role='tab')
                span.glyphicon.glyphicon-menu-hamburger(aria-hidden='true')
            li
              a(href='#drawTools', role='tab')
                span.glyphicon.glyphicon-pencil(aria-hidden='true')
            li
              a(href='#formTools', role='tab')
                span.glyphicon.glyphicon-search(aria-hidden='true')

          ul(role='tablist')
            // bottom aligned tabs
            li
              a(href='#settings', role='tab')
                span.glyphicon.glyphicon-cog(aria-hidden='true')

        // Tab panes
        .sidebar-content
          #layers.sidebar-pane
            h1.sidebar-header
              | Layers
              .sidebar-close
                span.glyphicon.glyphicon-menu-left(aria-hidden='true')
            p this is some text

          #drawTools.sidebar-pane
            h1.sidebar-header
              | Draw Tools
              .sidebar-close
                span.glyphicon.glyphicon-menu-left(aria-hidden='true')

          #formTools.sidebar-pane
            h1.sidebar-header
              | Form Tools
              .sidebar-close
                span.glyphicon.glyphicon-menu-left(aria-hidden='true')
              #sidebar1
                
          #settings.sidebar-pane
            h1.sidebar-header
              | Settings
              .sidebar-close
                span.glyphicon.glyphicon-menu-left(aria-hidden='true')
                
      script. 
        var sidebar = L.control.sidebar('sidebar').addTo(map);
          
      //#popUp_FormDIV
        #popUpDIV
        #formPopDIV
          script(src='/public/scripts/formDIV.js')
      
    //script( src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js' type='text/javascript' )
    //script( src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js' type='text/javascript' )
        
    ////Side bar for leaflet map
          //var sidebar = L.control.sidebar('sidebar', {
            position: 'left'
          //});
          //map.addControl(sidebar);

          //setTimeout(function () {
            sidebar.show();
          //}, 500);
    //footer
      #footerDIV
      .row
        .col-md-12
          p
            center
              a(href='sitemap.html', style='  text-align: center;  padding:20px; font-size: 14px;') Site Map
              a(href='security.html', style=' text-align: center;  padding:20px; font-size: 14px;') Privacy & Security
              a(href='foia.html', style='  text-align: center;  padding:20px; font-size: 14px;') FOIA
              a(href='nofear.html', style='  text-align: center;  padding:20px; font-size: 14px;') No Fear Act
              a(href='license.html', style='  text-align: center;  padding:20px; font-size: 14px;') License
              a(href='http://dodcio.defense.gov/DoDSection508/Std_Stmt.aspx', target='_blank', style='  text-align: center;  padding:20px; font-size: 14px;') Accessibility/Section 508
              a(href='http://www.usa.gov', target='_blank', style='  text-align: center;  padding:20px; font-size: 14px;mar') USA.gov
    
    