L.CanvasTiles=L.GridLayer.extend({initialize:function(t,i,n){this._userDrawFunc=t,this._callContext=n,L.setOptions(this,i);var e=this;return this.drawTile=function(t,i,n){this._draw(t,i,n),e.options.debug&&e._drawDebugInfo(t,i,n)},this},drawing:function(t){return this._userDrawFunc=t,this},params:function(t){return this.options.maxZoom=22,L.setOptions(this,t),this},addTo:function(t){return t.addLayer(this),this},_drawDebugInfo:function(t,i,n){var e=this.options.tileSize,o=t.getContext("2d");o.globalCompositeOperation="destination-over",o.strokeStyle="#FFFFFF",o.fillStyle="#FFFFFF",o.strokeRect(0,0,e,e),o.font="12px Arial",o.fillRect(0,0,5,5),o.fillRect(0,e-5,5,5),o.fillRect(e-5,0,5,5),o.fillRect(e-5,e-5,5,5),o.fillRect(e/2-5,e/2-5,10,10),o.strokeText(i.x+" "+i.y+" "+n,e/2-30,e/2-10)},tilePoint:function(t,i,n,e){var o=n.multiplyBy(e),s=t.project(new L.LatLng(i[0],i[1]));return{x:Math.round(s.x-o.x),y:Math.round(s.y-o.y)}},_boundsToQuery:function(t){return void 0==t.getSouthWest()?{x:0,y:0,width:.1,height:.1}:{x:t.getSouthWest().lng,y:t.getSouthWest().lat,width:t.getNorthEast().lng-t.getSouthWest().lng,height:t.getNorthEast().lat-t.getSouthWest().lat}},_draw:function(t,i,n){var e=this.options.tileSize,o=i.multiplyBy(e),s=o.add(new L.Point(e,e)),a=new L.Point(this.options.padding,this.options.padding);o=o.subtract(a),s=s.add(a);var r=new L.LatLngBounds(this._map.unproject(s),this._map.unproject(o)),l=1/(40075016.68/e/Math.pow(2,n));this._userDrawFunc&&this._userDrawFunc.call(this._callContext,this,{canvas:t,tilePoint:i,bounds:r,size:e,zoomScale:l,zoom:n,options:this.options})}}),L.canvasTiles=function(t,i,n){return new L.CanvasTiles(t,i,n)};