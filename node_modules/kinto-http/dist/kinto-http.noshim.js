(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.KintoClient = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

},{}],2:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,i,n,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(i=this._events[e],isUndefined(i))return!1;if(isFunction(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(isObject(i))for(s=Array.prototype.slice.call(arguments,1),o=i.slice(),n=o.length,r=0;r<n;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var i;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(i=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},EventEmitter.prototype.removeListener=function(e,t){var i,n,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||isFunction(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(i)){for(r=s;r-- >0;)if(i[r]===t||i[r].listener&&i[r].listener===t){n=r;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],isFunction(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};

},{}],3:[function(require,module,exports){
var v1=require("./v1"),v4=require("./v4"),uuid=v4;uuid.v1=v1,uuid.v4=v4,module.exports=uuid;
},{"./v1":6,"./v4":7}],4:[function(require,module,exports){
function bytesToUuid(e,t){var o=t||0,i=byteToHex;return i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]}for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=bytesToUuid;

},{}],5:[function(require,module,exports){
(function (global){
var rng,crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(rnds8),rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var r,n=0;n<16;n++)0===(3&n)&&(r=4294967296*Math.random()),rnds[n]=r>>>((3&n)<<3)&255;return rnds}}module.exports=rng;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],6:[function(require,module,exports){
function v1(e,s,t){var c=s&&t||0,d=s||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:_clockseq,r=void 0!==e.msecs?e.msecs:(new Date).getTime(),_=void 0!==e.nsecs?e.nsecs:_lastNSecs+1,a=r-_lastMSecs+(_-_lastNSecs)/1e4;if(a<0&&void 0===e.clockseq&&(o=o+1&16383),(a<0||r>_lastMSecs)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=r,_lastNSecs=_,_clockseq=o,r+=122192928e5;var i=(1e4*(268435455&r)+_)%4294967296;d[c++]=i>>>24&255,d[c++]=i>>>16&255,d[c++]=i>>>8&255,d[c++]=255&i;var l=r/4294967296*1e4&268435455;d[c++]=l>>>8&255,d[c++]=255&l,d[c++]=l>>>24&15|16,d[c++]=l>>>16&255,d[c++]=o>>>8|128,d[c++]=255&o;for(var n=e.node||_nodeId,v=0;v<6;++v)d[c+v]=n[v];return s?s:bytesToUuid(d)}var rng=require("./lib/rng"),bytesToUuid=require("./lib/bytesToUuid"),_seedBytes=rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0;module.exports=v1;
},{"./lib/bytesToUuid":4,"./lib/rng":5}],7:[function(require,module,exports){
function v4(r,n,e){var i=n&&e||0;"string"==typeof r&&(n="binary"==r?new Array(16):null,r=null),r=r||{};var u=r.random||(r.rng||rng)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,n)for(var o=0;o<16;++o)n[i+o]=u[o];return n||bytesToUuid(u)}var rng=require("./lib/rng"),bytesToUuid=require("./lib/bytesToUuid");module.exports=v4;

},{"./lib/bytesToUuid":4,"./lib/rng":5}],8:[function(require,module,exports){
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(s,a){try{var i=t[s](a),o=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _applyDecoratedDescriptor(e,t,r,n,s){var a={};return Object.keys(n).forEach(function(e){a[e]=n[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},a),s&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(s):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.SUPPORTED_PROTOCOL_VERSION=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_dec,_dec2,_dec3,_dec4,_dec5,_dec6,_dec7,_desc,_value,_class,_utils=require("./utils"),_http=require("./http"),_http2=_interopRequireDefault(_http),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_batch=require("./batch"),_bucket=require("./bucket"),_bucket2=_interopRequireDefault(_bucket),SUPPORTED_PROTOCOL_VERSION=exports.SUPPORTED_PROTOCOL_VERSION="v1",KintoClientBase=(_dec=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec2=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec3=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec4=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec5=(0,_utils.nobatch)("Can't use batch within a batch!"),_dec6=(0,_utils.capable)(["permissions_endpoint"]),_dec7=(0,_utils.support)("1.4","2.0"),_class=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,e),"string"!=typeof t||!t.length)throw new Error("Invalid remote URL: "+t);"/"===t[t.length-1]&&(t=t.slice(0,-1)),this._backoffReleaseTime=null,this._requests=[],this._isBatch=!!r.batch,this._retry=r.retry||0,this._safe=!!r.safe,this._headers=r.headers||{},this.remote=t,this.serverInfo=null,this.events=r.events;var n=r.requestMode,s=r.timeout;this.http=new _http2.default(this.events,{requestMode:n,timeout:s}),this._registerHTTPEvents()}return _createClass(e,[{key:"_registerHTTPEvents",value:function(){var e=this;this._isBatch||this.events.on("backoff",function(t){e._backoffReleaseTime=t})}},{key:"bucket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new _bucket2.default(this,e,{batch:this._isBatch,headers:this._getHeaders(t),safe:this._getSafe(t),retry:this._getRetry(t)})}},{key:"_getHeaders",value:function(e){return _extends({},this._headers,e.headers)}},{key:"_getSafe",value:function(e){return _extends({safe:this._safe},e).safe}},{key:"_getRetry",value:function(e){return _extends({retry:this._retry},e).retry}},{key:"_getHello",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.remote+(0,_endpoint2.default)("root"),e.next=3,this.http.request(t,{headers:this._getHeaders(s)},{retry:this._getRetry(s)});case 3:return r=e.sent,n=r.json,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"fetchServerInfo",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.serverInfo){e.next=2;break}return e.abrupt("return",this.serverInfo);case 2:return e.next=4,this._getHello({retry:this._getRetry(t)});case 4:return this.serverInfo=e.sent,e.abrupt("return",this.serverInfo);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"fetchServerSettings",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchServerInfo(t);case 2:return r=e.sent,n=r.settings,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"fetchServerCapabilities",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchServerInfo(n);case 2:return t=e.sent,r=t.capabilities,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"fetchUser",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getHello(n);case 2:return t=e.sent,r=t.user,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"fetchHTTPApiVersion",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchServerInfo(n);case 2:return t=e.sent,r=t.http_api_version,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"_batchRequests",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,s,a,i,o,u=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._getHeaders(c),t.length){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this.fetchServerSettings({retry:this._getRetry(c)});case 5:if(n=e.sent,s=n.batch_max_requests,!(s&&t.length>s)){e.next=10;break}return a=(0,_utils.partition)(t,s),e.abrupt("return",(0,_utils.pMap)(a,function(e){return u._batchRequests(e,c)}));case 10:return e.next=12,this.execute({headers:r,path:(0,_endpoint2.default)("batch"),method:"POST",body:{defaults:{headers:r},requests:t}},{retry:this._getRetry(c)});case 12:return i=e.sent,o=i.responses,e.abrupt("return",o);case 15:case"end":return e.stop()}},e,this)}));return e}()},{key:"batch",value:function(){function t(e){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function t(r){var n,s,a,i,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e(this.remote,{events:this.events,batch:!0,safe:this._getSafe(u),retry:this._getRetry(u)}),s=void 0,a=void 0,u.bucket&&(s=n.bucket(u.bucket),u.collection&&(a=s.collection(u.collection))),i=a||s||n,r(i),t.next=7,this._batchRequests(n._requests,u);case 7:if(o=t.sent,!u.aggregate){t.next=12;break}return t.abrupt("return",(0,_batch.aggregate)(o,n._requests));case 12:return t.abrupt("return",o);case 13:case"end":return t.stop()}},t,this)}));return t}()},{key:"execute",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,s,a,i,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.raw,n=void 0!==r&&r,s=u.stringify,a=void 0===s||s,!this._isBatch){e.next=5;break}return this._requests.push(t),i="This result is generated from within a batch operation and should not be consumed.",e.abrupt("return",n?{json:i,headers:{get:function(){}}}:i);case 5:return e.next=7,this.http.request(this.remote+t.path,(0,_utils.cleanUndefinedProperties)({method:t.method,headers:t.headers,body:a?JSON.stringify(t.body):t.body}),{retry:this._getRetry(u)});case 7:return o=e.sent,e.abrupt("return",n?o:o.json);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"paginatedList",value:function(){function e(e,r){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,s,a,i,o,u,c,p,h,f,l,d,_,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_extends({sort:"-last_modified"},r),s=n.sort,a=n.filters,i=n.limit,o=n.pages,u=n.since,!u||"string"==typeof u){e.next=3;break}throw new Error("Invalid value for since ("+u+"), should be ETag value.");case 3:return c=(0,_utils.qsify)(_extends({},a,{_sort:s,_limit:i,_since:u})),p=[],h=0,f=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("Pagination exhausted.");case 2:return e.abrupt("return",l(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=v.headers,e.t0=_,e.next=4,this.http.request(t,{headers:r});case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}().bind(this),d=function(e,t,r,n){return{last_modified:r?r.replace(/"/g,""):r,data:e,next:f.bind(null,t),hasNextPage:!!t,totalRecords:n}},_=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,s,a=t.headers,i=t.json;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.get("Next-Page"),n=a.get("ETag"),s=parseInt(a.get("Total-Records"),10),o){e.next=5;break}return e.abrupt("return",d(i.data,r,n,s));case 5:if(p=p.concat(i.data),h+=1,!(h>=o)&&r){e.next=9;break}return e.abrupt("return",d(p,r,n,s));case 9:return e.abrupt("return",l(r));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),e.t0=_,e.next=12,this.execute({headers:v.headers,path:t+"?"+c},{raw:!0,retry:v.retry||0});case 12:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"listPermissions",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("permissions"),r=_extends({sort:"id"},n),e.abrupt("return",this.paginatedList(t,r,{headers:this._getHeaders(n),retry:this._getRetry(n)}));case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"listBuckets",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("bucket"),e.abrupt("return",this.paginatedList(t,r,{headers:this._getHeaders(r),retry:this._getRetry(r)}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"createBucket",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,s,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.data,n=void 0===r?{}:r,s=i.permissions,null!=t&&(n.id=t),a=n.id?(0,_endpoint2.default)("bucket",n.id):(0,_endpoint2.default)("bucket"),e.abrupt("return",this.execute(requests.createRequest(a,{data:n,permissions:s},{headers:this._getHeaders(i),safe:this._getSafe(i)}),{retry:this._getRetry(i)}));case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteBucket",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,s,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,_utils.toDataBody)(t),r.id){e.next=3;break}throw new Error("A bucket id is required.");case 3:return n=(0,_endpoint2.default)("bucket",r.id),s=_extends({},r,i),a=s.last_modified,e.abrupt("return",this.execute(requests.deleteRequest(n,{last_modified:a,headers:this._getHeaders(i),safe:this._getSafe(i)}),{retry:this._getRetry(i)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteBuckets",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("bucket"),e.abrupt("return",this.execute(requests.deleteRequest(t,{last_modified:r.last_modified,headers:this._getHeaders(r),safe:this._getSafe(r)}),{retry:this._getRetry(r)}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"remote",get:function(){return this._remote},set:function(e){var t=void 0;try{t=e.match(/\/(v\d+)\/?$/)[1]}catch(t){throw new Error("The remote URL must contain the version: "+e)}if(t!==SUPPORTED_PROTOCOL_VERSION)throw new Error("Unsupported protocol version: "+t);this._remote=e,this._version=t}},{key:"version",get:function(){return this._version}},{key:"backoff",get:function(){var e=(new Date).getTime();return this._backoffReleaseTime&&e<this._backoffReleaseTime?this._backoffReleaseTime-e:0}}]),e}(),_applyDecoratedDescriptor(_class.prototype,"fetchServerSettings",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"fetchServerSettings"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchServerCapabilities",[_dec2],Object.getOwnPropertyDescriptor(_class.prototype,"fetchServerCapabilities"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchUser",[_dec3],Object.getOwnPropertyDescriptor(_class.prototype,"fetchUser"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchHTTPApiVersion",[_dec4],Object.getOwnPropertyDescriptor(_class.prototype,"fetchHTTPApiVersion"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"batch",[_dec5],Object.getOwnPropertyDescriptor(_class.prototype,"batch"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"listPermissions",[_dec6],Object.getOwnPropertyDescriptor(_class.prototype,"listPermissions"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"deleteBuckets",[_dec7],Object.getOwnPropertyDescriptor(_class.prototype,"deleteBuckets"),_class.prototype),_class);exports.default=KintoClientBase;

},{"./batch":9,"./bucket":10,"./endpoint":12,"./http":14,"./requests":16,"./utils":17}],9:[function(require,module,exports){
"use strict";function aggregate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e.length!==t.length)throw new Error("Responses length should match requests one.");var r={errors:[],published:[],conflicts:[],skipped:[]};return e.reduce(function(e,r,s){var o=r.status,i=t[s];if(o>=200&&o<400)e.published.push(r.body);else if(404===o){var l=i.path.match(/(buckets|groups|collections|records)\/([^\/]+)$/),n=3===l.length?l[2]:void 0;e.skipped.push({id:n,path:i.path,error:r.body})}else 412===o?e.conflicts.push({type:"outgoing",local:i.body,remote:r.body.details&&r.body.details.existing||null}):e.errors.push({path:i.path,sent:i,error:r.body});return e},r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.aggregate=aggregate;

},{}],10:[function(require,module,exports){
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,a){try{var s=t[i](a),u=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _applyDecoratedDescriptor(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(e){a[e]=n[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_dec,_desc,_value,_class,_utils=require("./utils"),_collection=require("./collection"),_collection2=_interopRequireDefault(_collection),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),Bucket=(_dec=(0,_utils.capable)(["history"]),_class=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e),this.client=t,this.name=r,this._isBatch=!!n.batch,this._headers=n.headers||{},this._retry=n.retry||0,this._safe=!!n.safe}return _createClass(e,[{key:"_getHeaders",value:function(e){return _extends({},this._headers,e.headers)}},{key:"_getSafe",value:function(e){return _extends({safe:this._safe},e).safe}},{key:"_getRetry",value:function(e){return _extends({retry:this._retry},e).retry}},{key:"collection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new _collection2.default(this.client,this,e,{batch:this._isBatch,headers:this._getHeaders(t),retry:this._getRetry(t),safe:this._getSafe(t)})}},{key:"getData",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={headers:this._getHeaders(i),path:(0,_endpoint2.default)("bucket",this.name)},e.next=3,this.client.execute(t,{retry:this._getRetry(i)});case 3:return r=e.sent,n=r.data,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"setData",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s,u,o,c,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A bucket object is required.");case 2:return r=_extends({},t,{id:this.name}),n=r.id,"default"===r.id&&delete r.id,i=(0,_endpoint2.default)("bucket",n),a=d.patch,s=d.permissions,u=_extends({},t,d),o=u.last_modified,c=requests.updateRequest(i,{data:r,permissions:s},{last_modified:o,patch:a,headers:this._getHeaders(d),safe:this._getSafe(d)}),e.abrupt("return",this.client.execute(c,{retry:this._getRetry(d)}));case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"listHistory",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("history",this.name),e.abrupt("return",this.client.paginatedList(t,r,{headers:this._getHeaders(r),retry:this._getRetry(r)}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"listCollections",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("collection",this.name),e.abrupt("return",this.client.paginatedList(t,r,{headers:this._getHeaders(r),retry:this._getRetry(r)}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"createCollection",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.permissions,n=u.data,i=void 0===n?{}:n,i.id=t,a=(0,_endpoint2.default)("collection",this.name,t),s=requests.createRequest(a,{data:i,permissions:r},{headers:this._getHeaders(u),safe:this._getSafe(u)}),e.abrupt("return",this.client.execute(s,{retry:this._getRetry(u)}));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteCollection",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,_utils.toDataBody)(t),r.id){e.next=3;break}throw new Error("A collection id is required.");case 3:return n=r.id,i=_extends({},r,o),a=i.last_modified,s=(0,_endpoint2.default)("collection",this.name,n),u=requests.deleteRequest(s,{last_modified:a,headers:this._getHeaders(o),safe:this._getSafe(o)}),e.abrupt("return",this.client.execute(u,{retry:this._getRetry(o)}));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"listGroups",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("group",this.name),e.abrupt("return",this.client.paginatedList(t,r,{headers:this._getHeaders(r),retry:this._getRetry(r)}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"getGroup",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={headers:this._getHeaders(n),path:(0,_endpoint2.default)("group",this.name,t)},e.abrupt("return",this.client.execute(r,{retry:this._getRetry(n)}));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"createGroup",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_extends({},u.data,{id:t,members:s}),n=(0,_endpoint2.default)("group",this.name,t),i=u.permissions,a=requests.createRequest(n,{data:r,permissions:i},{headers:this._getHeaders(u),safe:this._getSafe(u)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(u)}));case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"updateGroup",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s,u,o,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A group object is required.");case 2:if(t.id){e.next=4;break}throw new Error("A group id is required.");case 4:return r=_extends({},c.data,t),n=(0,_endpoint2.default)("group",this.name,t.id),i=c.patch,a=c.permissions,s=_extends({},r,c),u=s.last_modified,o=requests.updateRequest(n,{data:r,permissions:a},{last_modified:u,patch:i,headers:this._getHeaders(c),safe:this._getSafe(c)}),e.abrupt("return",this.client.execute(o,{retry:this._getRetry(c)}));case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteGroup",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,_utils.toDataBody)(t),n=r.id,i=_extends({},r,o),a=i.last_modified,s=(0,_endpoint2.default)("group",this.name,n),u=requests.deleteRequest(s,{last_modified:a,headers:this._getHeaders(o),safe:this._getSafe(o)}),e.abrupt("return",this.client.execute(u,{retry:this._getRetry(o)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"getPermissions",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={headers:this._getHeaders(i),path:(0,_endpoint2.default)("bucket",this.name)},e.next=3,this.client.execute(t,{retry:this._getRetry(i)});case 3:return r=e.sent,n=r.permissions,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"setPermissions",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A permissions object is required.");case 2:return r=(0,_endpoint2.default)("bucket",this.name),n=s.last_modified,i={last_modified:n},a=requests.updateRequest(r,{data:i,permissions:t},{headers:this._getHeaders(s),safe:this._getSafe(s)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(s)}));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"addPermissions",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A permissions object is required.");case 2:return r=(0,_endpoint2.default)("bucket",this.name),n=a.last_modified,i=requests.jsonPatchPermissionsRequest(r,t,"add",{last_modified:n,headers:this._getHeaders(a),safe:this._getSafe(a)}),e.abrupt("return",this.client.execute(i,{retry:this._getRetry(a)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"removePermissions",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A permissions object is required.");case 2:return r=(0,_endpoint2.default)("bucket",this.name),n=a.last_modified,i=requests.jsonPatchPermissionsRequest(r,t,"remove",{last_modified:n,headers:this._getHeaders(a),safe:this._getSafe(a)}),e.abrupt("return",this.client.execute(i,{retry:this._getRetry(a)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"batch",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.batch(t,{bucket:this.name,headers:this._getHeaders(r),retry:this._getRetry(r),safe:this._getSafe(r),aggregate:!!r.aggregate}));case 1:case"end":return e.stop()}},e,this)}));return e}()}]),e}(),_applyDecoratedDescriptor(_class.prototype,"listHistory",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"listHistory"),_class.prototype),_class);exports.default=Bucket;

},{"./collection":11,"./endpoint":12,"./requests":16,"./utils":17}],11:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,i){try{var s=t[a](i),o=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _applyDecoratedDescriptor(e,t,r,n,a){var i={};return Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),a&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(a):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _slicedToArray=function(){function e(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_dec,_dec2,_dec3,_desc,_value,_class,_uuid=require("uuid"),_utils=require("./utils"),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),Collection=(_dec=(0,_utils.capable)(["attachments"]),_dec2=(0,_utils.capable)(["attachments"]),_dec3=(0,_utils.capable)(["history"]),_class=function(){function e(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,e),this.client=t,this.bucket=r,this.name=n,this._isBatch=!!a.batch,this._retry=a.retry||0,this._safe=!!a.safe,this._headers=_extends({},this.bucket._headers,a.headers)}return _createClass(e,[{key:"_getHeaders",value:function(e){return _extends({},this._headers,e.headers)}},{key:"_getSafe",value:function(e){return _extends({safe:this._safe},e).safe}},{key:"_getRetry",value:function(e){return _extends({retry:this._retry},e).retry}},{key:"getTotalRecords",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("record",this.bucket.name,this.name),r={headers:this._getHeaders(i),path:t,method:"HEAD"},e.next=4,this.client.execute(r,{raw:!0,retry:this._getRetry(i)});case 4:return n=e.sent,a=n.headers,e.abrupt("return",parseInt(a.get("Total-Records"),10));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"getData",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("collection",this.bucket.name,this.name),r={headers:this._getHeaders(i),path:t},e.next=4,this.client.execute(r,{retry:this._getRetry(i)});case 4:return n=e.sent,a=n.data,e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"setData",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A collection object is required.");case 2:return r=u.patch,n=u.permissions,a=_extends({},t,u),i=a.last_modified,s=(0,_endpoint2.default)("collection",this.bucket.name,this.name),o=requests.updateRequest(s,{data:t,permissions:n},{last_modified:i,patch:r,headers:this._getHeaders(u),safe:this._getSafe(u)}),e.abrupt("return",this.client.execute(o,{retry:this._getRetry(u)}));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"getPermissions",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,_endpoint2.default)("collection",this.bucket.name,this.name),r={headers:this._getHeaders(i),path:t},e.next=4,this.client.execute(r,{retry:this._getRetry(i)});case 4:return n=e.sent,a=n.permissions,e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"setPermissions",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A permissions object is required.");case 2:return r=(0,_endpoint2.default)("collection",this.bucket.name,this.name),n={last_modified:i.last_modified},a=requests.updateRequest(r,{data:n,permissions:t},{headers:this._getHeaders(i),safe:this._getSafe(i)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(i)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"addPermissions",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A permissions object is required.");case 2:return r=(0,_endpoint2.default)("collection",this.bucket.name,this.name),n=i.last_modified,a=requests.jsonPatchPermissionsRequest(r,t,"add",{last_modified:n,headers:this._getHeaders(i),safe:this._getSafe(i)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(i)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"removePermissions",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A permissions object is required.");case 2:return r=(0,_endpoint2.default)("collection",this.bucket.name,this.name),n=i.last_modified,a=requests.jsonPatchPermissionsRequest(r,t,"remove",{last_modified:n,headers:this._getHeaders(i),safe:this._getSafe(i)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(i)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"createRecord",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.permissions,n=(0,_endpoint2.default)("record",this.bucket.name,this.name,t.id),a=requests.createRequest(n,{data:t,permissions:r},{headers:this._getHeaders(i),safe:this._getSafe(i)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(i)}));case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"addAttachment",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.permissions,n=u.id||_uuid.v4.v4(),a=(0,_endpoint2.default)("attachment",this.bucket.name,this.name,n),i=_extends({},u,c),s=i.last_modified,o=requests.addAttachmentRequest(a,t,{data:u,permissions:r},{last_modified:s,filename:c.filename,gzipped:c.gzipped,headers:this._getHeaders(c),safe:this._getSafe(c)}),e.next=7,this.client.execute(o,{stringify:!1,retry:this._getRetry(c)});case 7:return e.abrupt("return",this.getRecord(n));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeAttachment",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.last_modified,n=(0,_endpoint2.default)("attachment",this.bucket.name,this.name,t),a=requests.deleteRequest(n,{last_modified:r,headers:this._getHeaders(i),safe:this._getSafe(i)}),e.abrupt("return",this.client.execute(a,{retry:this._getRetry(i)}));case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"updateRecord",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_utils.isObject)(t)){e.next=2;break}throw new Error("A record object is required.");case 2:if(t.id){e.next=4;break}throw new Error("A record id is required.");case 4:return r=o.permissions,n=_extends({},t,o),a=n.last_modified,i=(0,_endpoint2.default)("record",this.bucket.name,this.name,t.id),s=requests.updateRequest(i,{data:t,permissions:r},{headers:this._getHeaders(o),safe:this._getSafe(o),last_modified:a,patch:!!o.patch}),e.abrupt("return",this.client.execute(s,{retry:this._getRetry(o)}));case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteRecord",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,_utils.toDataBody)(t),r.id){e.next=3;break}throw new Error("A record id is required.");case 3:return n=r.id,a=_extends({},r,u),i=a.last_modified,s=(0,_endpoint2.default)("record",this.bucket.name,this.name,n),o=requests.deleteRequest(s,{last_modified:i,headers:this._getHeaders(u),safe:this._getSafe(u)}),e.abrupt("return",this.client.execute(o,{retry:this._getRetry(u)}));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"getRecord",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,_endpoint2.default)("record",this.bucket.name,this.name,t),n={headers:this._getHeaders(a),path:r},e.abrupt("return",this.client.execute(n,{retry:this._getRetry(a)}));case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"listRecords",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,_endpoint2.default)("record",this.bucket.name,this.name),!r.hasOwnProperty("at")){e.next=5;break}return e.abrupt("return",this.getSnapshot(r.at));case 5:return e.abrupt("return",this.client.paginatedList(t,r,{headers:this._getHeaders(r),retry:this._getRetry(r)}));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"isHistoryComplete",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bucket.listHistory({limit:1,filters:{action:"create",resource_name:"collection",collection_id:this.name}});case 2:return t=e.sent,r=_slicedToArray(t.data,1),n=r[0],e.abrupt("return",!!n);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"listChangesBackTo",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.isHistoryComplete();case 2:if(e.sent){e.next=4;break}throw new Error("Computing a snapshot is only possible when the full history for a collection is available. Here, the history plugin seems to have been enabled after the creation of the collection.");case 4:return e.next=6,this.bucket.listHistory({pages:1/0,sort:"-target.data.last_modified",filters:{resource_name:"record",collection_id:this.name,"max_target.data.last_modified":String(t)}});case 6:return r=e.sent,n=r.data,e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"getSnapshot",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o,u,c,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Number.isInteger(t)&&!(t<=0)){e.next=2;break}throw new Error("Invalid argument, expected a positive integer.");case 2:return e.next=4,this.listChangesBackTo(t);case 4:for(r=e.sent,n=new Set,a=[],i=!0,s=!1,o=void 0,e.prev=10,u=function(){var e=d.value,t=e.action,r=e.target.data;"delete"==t?(n.add(r.id),a=a.filter(function(e){return e.id!==r.id})):n.has(r.id)||(n.add(r.id),a.push(r))},c=r[Symbol.iterator]();!(i=(d=c.next()).done);i=!0)u();e.next=19;break;case 15:e.prev=15,e.t0=e.catch(10),s=!0,o=e.t0;case 19:e.prev=19,e.prev=20,!i&&c.return&&c.return();case 22:if(e.prev=22,!s){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return",{last_modified:String(t),data:a.sort(function(e,t){return t.last_modified-e.last_modified}),next:function(){throw new Error("Snapshots don't support pagination")},hasNextPage:!1,totalRecords:a.length});case 28:case"end":return e.stop()}},e,this,[[10,15,19,27],[20,,22,26]])}));return e}()},{key:"batch",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.batch(t,{bucket:this.bucket.name,collection:this.name,headers:this._getHeaders(r),retry:this._getRetry(r),safe:this._getSafe(r),aggregate:!!r.aggregate}));case 1:case"end":return e.stop()}},e,this)}));return e}()}]),e}(),_applyDecoratedDescriptor(_class.prototype,"addAttachment",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"addAttachment"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"removeAttachment",[_dec2],Object.getOwnPropertyDescriptor(_class.prototype,"removeAttachment"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"getSnapshot",[_dec3],Object.getOwnPropertyDescriptor(_class.prototype,"getSnapshot"),_class.prototype),_class);exports.default=Collection;

},{"./endpoint":12,"./requests":16,"./utils":17,"uuid":3}],12:[function(require,module,exports){
"use strict";function endpoint(t){for(var n=arguments.length,r=Array(n>1?n-1:0),e=1;e<n;e++)r[e-1]=arguments[e];return ENDPOINTS[t].apply(ENDPOINTS,r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=endpoint;var ENDPOINTS={root:function(){return"/"},batch:function(){return"/batch"},permissions:function(){return"/permissions"},bucket:function(t){return"/buckets"+(t?"/"+t:"")},history:function(t){return ENDPOINTS.bucket(t)+"/history"},collection:function(t,n){return ENDPOINTS.bucket(t)+"/collections"+(n?"/"+n:"")},group:function(t,n){return ENDPOINTS.bucket(t)+"/groups"+(n?"/"+n:"")},record:function(t,n,r){return ENDPOINTS.collection(t,n)+"/records"+(r?"/"+r:"")},attachment:function(t,n,r){return ENDPOINTS.record(t,n,r)+"/attachment"}};

},{}],13:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default={104:"Missing Authorization Token",105:"Invalid Authorization Token",106:"Request body was not valid JSON",107:"Invalid request parameter",108:"Missing request parameter",109:"Invalid posted data",110:"Invalid Token / id",111:"Missing Token / id",112:"Content-Length header was not provided",113:"Request body too large",114:"Resource was created, updated or deleted meanwhile",115:"Method not allowed on this end point (hint: server may be readonly)",116:"Requested version not available on this server",117:"Client has sent too many requests",121:"Resource access is forbidden for this user",122:"Another resource violates constraint",201:"Service Temporary unavailable due to high load",202:"Service deprecated",999:"Internal Server Error"};

},{}],14:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var s=r[a](o),u=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}return n("next")})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_utils=require("./utils"),_errors=require("./errors"),_errors2=_interopRequireDefault(_errors),HTTP=function(){function e(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,e),!r)throw new Error("No events handler provided");this.events=r,this.requestMode=t.requestMode||e.defaultOptions.requestMode,this.timeout=t.timeout||e.defaultOptions.timeout}return _createClass(e,null,[{key:"DEFAULT_REQUEST_HEADERS",get:function(){return{Accept:"application/json","Content-Type":"application/json"}}},{key:"defaultOptions",get:function(){return{timeout:null,requestMode:"cors"}}}]),_createClass(e,[{key:"timedFetch",value:function(e,r){var t=this,n=!1;return new Promise(function(a,o){function s(e){return function(r){n||(u&&clearTimeout(u),e(r))}}var u=void 0;t.timeout&&(u=setTimeout(function(){n=!0,o(new Error("Request timeout."))},t.timeout)),fetch(e,r).then(s(a)).catch(s(o))})}},{key:"processResponse",value:function(){function e(e){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.status,e.next=3,r.text();case 3:if(n=e.sent,0!==n.length){e.next=6;break}return e.abrupt("return",this.formatResponse(r,null));case 6:return e.prev=6,e.abrupt("return",this.formatResponse(r,JSON.parse(n)));case 10:throw e.prev=10,e.t0=e.catch(6),a=new Error("HTTP "+(t||0)+"; "+e.t0),a.response=r,a.stack=e.t0.stack,a;case 16:case"end":return e.stop()}},e,this,[[6,10]])}));return e}()},{key:"formatResponse",value:function(e,r){var t=e.status,n=e.statusText,a=e.headers;if(r&&t>=400){var o="HTTP "+t+" "+(r.error||"")+": ";if(r.errno&&r.errno in _errors2.default){var s=_errors2.default[r.errno];o+=s,r.message&&r.message!==s&&(o+=" ("+r.message+")")}else o+=n||"";var u=new Error(o.trim());throw u.response=e,u.data=r,u}return{status:t,json:r,headers:a}}},{key:"retry",value:function(){function e(e,t,n,a){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n,a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_utils.delay)(t);case 2:return e.abrupt("return",this.request(r,n,_extends({},a,{retry:a.retry-1})));case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"request",value:function(){function r(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function r(t){var n,a,o,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{headers:{}},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{retry:0};return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return u.headers=_extends({},e.DEFAULT_REQUEST_HEADERS,u.headers),u.body&&"function"==typeof u.body.append&&delete u.headers["Content-Type"],u.mode=this.requestMode,r.next=5,this.timedFetch(t,u);case 5:if(n=r.sent,a=n.status,o=n.headers,this._checkForDeprecationHeader(o),this._checkForBackoffHeader(a,o),s=this._checkForRetryAfterHeader(a,o),!(s&&i.retry>0)){r.next=14;break}return r.abrupt("return",this.retry(t,s,u,i));case 14:return r.abrupt("return",this.processResponse(n));case 15:case"end":return r.stop()}},r,this)}));return r}()},{key:"_checkForDeprecationHeader",value:function(e){var r=e.get("Alert");if(r){var t=void 0;try{t=JSON.parse(r)}catch(e){return void console.warn("Unable to parse Alert header message",r)}console.warn(t.message,t.url),this.events.emit("deprecated",t)}}},{key:"_checkForBackoffHeader",value:function(e,r){var t=void 0,n=parseInt(r.get("Backoff"),10);t=n>0?(new Date).getTime()+1e3*n:0,this.events.emit("backoff",t)}},{key:"_checkForRetryAfterHeader",value:function(e,r){var t=r.get("Retry-After");if(t){var n=1e3*parseInt(t,10);return t=(new Date).getTime()+n,this.events.emit("retry-after",t),n}}}]),e}();exports.default=HTTP;

},{"./errors":13,"./utils":17}],15:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};require("babel-polyfill");var _events=require("events"),_base=require("./base"),_base2=_interopRequireDefault(_base),KintoClient=function(e){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var n=o.events||new _events.EventEmitter;return _possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Object.assign({events:n},o)))}return _inherits(t,e),t}(_base2.default);exports.default=KintoClient,"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=KintoClient);

},{"./base":8,"babel-polyfill":1,"events":2}],16:[function(require,module,exports){
"use strict";function safeHeader(e,t){return e?t?{"If-Match":'"'+t+'"'}:{"If-None-Match":"*"}:{}}function createRequest(e,t){var r=t.data,a=t.permissions,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=_extends({},requestDefaults,s),o=n.headers,i=n.safe;return{method:r&&r.id?"PUT":"POST",path:e,headers:_extends({},o,safeHeader(i)),body:{data:r,permissions:a}}}function updateRequest(e,t){var r=t.data,a=t.permissions,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=_extends({},requestDefaults,s),o=n.headers,i=n.safe,d=n.patch,u=_extends({},r,s),l=u.last_modified;return 0===Object.keys((0,_utils.omit)(r,"id","last_modified")).length&&(r=void 0),{method:d?"PATCH":"PUT",path:e,headers:_extends({},o,safeHeader(i,l)),body:{data:r,permissions:a}}}function jsonPatchPermissionsRequest(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=_extends({},requestDefaults,a),n=s.headers,o=s.safe,i=s.last_modified,d=[],u=!0,l=!1,f=void 0;try{for(var h,c=Object.entries(t)[Symbol.iterator]();!(u=(h=c.next()).done);u=!0){var p=_slicedToArray(h.value,2),v=p[0],m=p[1],y=!0,_=!1,q=void 0;try{for(var x,b=m[Symbol.iterator]();!(y=(x=b.next()).done);y=!0){var R=x.value;d.push({op:r,path:"/permissions/"+v+"/"+R})}}catch(e){_=!0,q=e}finally{try{!y&&b.return&&b.return()}finally{if(_)throw q}}}}catch(e){l=!0,f=e}finally{try{!u&&c.return&&c.return()}finally{if(l)throw f}}return{method:"PATCH",path:e,headers:_extends({},n,safeHeader(o,i),{"Content-Type":"application/json-patch+json"}),body:d}}function deleteRequest(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_extends({},requestDefaults,t),a=r.headers,s=r.safe,n=r.last_modified;if(s&&!n)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:e,headers:_extends({},a,safeHeader(s,n))}}function addAttachmentRequest(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.data,s=r.permissions,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=_extends({},requestDefaults,n),i=o.headers,d=o.safe,u=o.gzipped,l=_extends({},a,n),f=l.last_modified,h={data:a,permissions:s},c=(0,_utils.createFormData)(t,h,n),p=null!=u?p=e+"?gzipped="+(u?"true":"false"):e;return{method:"POST",path:p,headers:_extends({},i,safeHeader(d,f)),body:c}}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,t){var r=[],a=!0,s=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){s=!0,n=e}finally{try{!a&&i.return&&i.return()}finally{if(s)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};exports.createRequest=createRequest,exports.updateRequest=updateRequest,exports.jsonPatchPermissionsRequest=jsonPatchPermissionsRequest,exports.deleteRequest=deleteRequest,exports.addAttachmentRequest=addAttachmentRequest;var _utils=require("./utils"),requestDefaults={safe:!1,headers:{},permissions:void 0,data:void 0,patch:!1};

},{"./utils":17}],17:[function(require,module,exports){
"use strict";function _defineProperty(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function _toArray(r){return Array.isArray(r)?r:Array.from(r)}function _asyncToGenerator(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,t){function n(o,i){try{var a=e[o](i),u=a.value}catch(r){return void t(r)}if(!a.done)return Promise.resolve(u).then(function(r){n("next",r)},function(r){n("throw",r)});r(u)}return n("next")})}}function partition(r,e){return e<=0?r:r.reduce(function(r,t,n){return 0===n||n%e===0?r.push([t]):r[r.length-1].push(t),r},[])}function delay(r){return new Promise(function(e){return setTimeout(e,r)})}function omit(r){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Object.keys(r).reduce(function(e,n){return t.indexOf(n)===-1&&(e[n]=r[n]),e},{})}function toDataBody(r){if(isObject(r))return r;if("string"==typeof r)return{id:r};throw new Error("Invalid argument.")}function qsify(r){var e=function(r){return encodeURIComponent("boolean"==typeof r?String(r):r)},t=function(r){return JSON.parse(JSON.stringify(r))},n=t(r);return Object.keys(n).map(function(r){var t=e(r)+"=";return Array.isArray(n[r])?t+n[r].map(function(r){return e(r)}).join(","):t+e(n[r])}).join("&")}function checkVersion(r,e,t){var n=function(r){return r.split(".").map(function(r){return parseInt(r,10)})},o=n(r),i=_slicedToArray(o,2),a=i[0],u=i[1],c=n(e),f=_slicedToArray(c,2),s=f[0],p=f[1],l=n(t),y=_slicedToArray(l,2),d=y[0],v=y[1];if([a<s,a===s&&u<p,a>d,a===d&&u>=v].some(function(r){return r}))throw new Error("Version "+r+" doesn't satisfy "+e+" <= x < "+t)}function support(r,e){return function(t,n,o){var i=o.value;return{configurable:!0,get:function(){var t=this,o=function(){for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return("client"in t?t.client:t).fetchHTTPApiVersion().then(function(t){return checkVersion(t,r,e)}).then(function(){return i.apply(t,o)})};return Object.defineProperty(this,n,{value:o,configurable:!0,writable:!0}),o}}}}function capable(r){return function(e,t,n){var o=n.value;return{configurable:!0,get:function(){var e=this,n=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return("client"in e?e.client:e).fetchServerCapabilities().then(function(e){var t=r.filter(function(r){return!(r in e)});if(t.length>0){var n=t.join(", ");throw new Error("Required capabilities "+n+" not present on server")}}).then(function(){return o.apply(e,n)})};return Object.defineProperty(this,t,{value:n,configurable:!0,writable:!0}),n}}}}function nobatch(r){return function(e,t,n){var o=n.value;return{configurable:!0,get:function(){var e=this,n=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(e._isBatch)throw new Error(r);return o.apply(e,n)};return Object.defineProperty(this,t,{value:n,configurable:!0,writable:!0}),n}}}}function isObject(r){return"object"===(void 0===r?"undefined":_typeof(r))&&null!==r&&!Array.isArray(r)}function parseDataURL(r){var e=r.match(/^data:(.*);base64,(.*)/);if(!e)throw new Error("Invalid data-url: "+String(r).substr(0,32)+"...");var t=e[1],n=e[2],o=t.split(";"),i=_toArray(o),a=i[0];return _extends({},i.slice(1).reduce(function(r,e){var t=e.split("="),n=_slicedToArray(t,2);return _extends({},r,_defineProperty({},n[0],n[1]))},{}),{type:a,base64:n})}function extractFileInfo(r){for(var e=parseDataURL(r),t=e.name,n=e.type,o=e.base64,i=atob(o),a=[],u=0;u<i.length;u++)a.push(i.charCodeAt(u));return{blob:new Blob([new Uint8Array(a)],{type:n}),name:t}}function createFormData(r,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.filename,o=void 0===n?"untitled":n,i=extractFileInfo(r),a=i.blob,u=i.name,c=new FormData;c.append("attachment",a,u||o);for(var f in e)void 0!==e[f]&&c.append(f,JSON.stringify(e[f]));return c}function cleanUndefinedProperties(r){var e={};for(var t in r)void 0!==r[t]&&(e[t]=r[t]);return e}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_slicedToArray=function(){function r(r,e){var t=[],n=!0,o=!1,i=void 0;try{for(var a,u=r[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),!e||t.length!==e);n=!0);}catch(r){o=!0,i=r}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return t}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),pMap=exports.pMap=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(e,t){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=[],r.next=3,e.reduce(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(e,o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e;case 2:return r.t0=n,r.next=5,t(o);case 5:r.t1=r.sent,n=r.t0.concat.call(r.t0,r.t1);case 7:case"end":return r.stop()}},r,this)}));return function(e,t){return r.apply(this,arguments)}}(),Promise.resolve());case 3:return r.abrupt("return",n);case 4:case"end":return r.stop()}},r,this)}));return function(e,t){return r.apply(this,arguments)}}();exports.partition=partition,exports.delay=delay,exports.omit=omit,exports.toDataBody=toDataBody,exports.qsify=qsify,exports.checkVersion=checkVersion,exports.support=support,exports.capable=capable,exports.nobatch=nobatch,exports.isObject=isObject,exports.parseDataURL=parseDataURL,exports.extractFileInfo=extractFileInfo,exports.createFormData=createFormData,exports.cleanUndefinedProperties=cleanUndefinedProperties;

},{}]},{},[15])(15)
});